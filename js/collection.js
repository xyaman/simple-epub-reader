import{d as e,E as t}from"./db-Cnd-sZn5.js";class o{constructor(o){this.books=[],this.elem=o,(async()=>{const o=await e.getAllBooks();console.log(o);for(const e of o){const o=await t.newFromExistingObject(e.key,e.value);this.books.push(o)}console.log("All books have been loaded"),await this.render()})().then((()=>console.log("collection loaded")))}async addBookFromFile(o){const s=await t.newFromFile(o),i=await e.addBook(s);s.id=i,console.log("book added succesfully"),await s.loadContent(),this.books.push(s),await this.render()}async render(){this.elem.innerHTML="";const t=document.createElement("div");t.classList.add("columns","is-multiline","is-mobile");for(let o=0;o<this.books.length;o++){const s=document.createElement("div");s.classList.add("column","is-half-mobile","is-one-third-tablet","is-one-quarter-desktop","is-one-fifth-fullhd");const i=document.createElement("div");i.setAttribute("id","card-container"),s.appendChild(i);const a=document.createElement("a");i.appendChild(a),a.classList.add("card"),a.href="/simple-epub-reader/reader.html?id="+this.books[o].id;const n=document.createElement("div");a.appendChild(n),n.classList.add("card-image");const d=document.createElement("figure");n.appendChild(d),d.classList.add("image","is-3by4");const l=document.createElement("img");d.appendChild(l),l.style.objectFit="cover",l.src=await this.books[o].getCoverBlob();const c=document.createElement("a");c.classList.add("tag","is-delete"),c.setAttribute("id","delete-button"),i.appendChild(c);const r=document.createElement("progress");r.classList.add("progress","is-radiusless"),r.setAttribute("value",this.books[o].lastReadIndex||0),r.setAttribute("max",this.books[o].totalIndex||1),i.appendChild(r),c.onclick=async()=>{await e.removeBook(this.books[o].id),this.books.splice(o,1),await this.render()},t.appendChild(s)}this.elem.appendChild(t)}}let s;document.addEventListener("DOMContentLoaded",(()=>{s=new o(document.getElementById("books-container"))})),document.getElementById("file-input").addEventListener("change",(async function(e){e.target.files[0]&&(console.log("EPUB file: "+e.target.files[0].name),s.addBookFromFile(e.target.files[0]))}));
