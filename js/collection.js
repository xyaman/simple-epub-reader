import{d as e,E as t}from"./db-AIy8X3MZ.js";import"./settings.js";class s{constructor(s,o){this.books=[],this.elem=s,this.modalElem=o,(async()=>{const s=await e.getAllBooks();console.log(s);for(const e of s){const s=await t.newFromExistingObject(e.key,e.value);this.books.push(s)}console.log("All books have been loaded"),await this.render()})().then((()=>console.log("collection loaded")))}async addBookFromFile(s){const o=await t.newFromFile(s),d=await e.addBook(o);o.id=d,console.log("book added succesfully"),await o.loadContent(),this.books.push(o),await this.render()}async render(){this.elem.innerHTML="";const t=document.createElement("div");t.classList.add("columns","is-multiline","is-mobile");for(let s=0;s<this.books.length;s++){const o=document.createElement("div");o.classList.add("column","is-half-mobile","is-one-third-tablet","is-one-quarter-desktop","is-one-fifth-fullhd");const d=document.createElement("div");d.setAttribute("id","card-container"),o.appendChild(d);const n=document.createElement("a");d.appendChild(n),n.classList.add("card"),n.href="/simple-epub-reader/reader.html?id="+this.books[s].id;const a=document.createElement("div");n.appendChild(a),a.classList.add("card-image");const i=document.createElement("figure");a.appendChild(i),i.classList.add("image","is-3by4");const l=document.createElement("img");i.appendChild(l),l.style.objectFit="cover",l.src=await this.books[s].getCoverBlob();const c=document.createElement("a");c.classList.add("tag","is-delete"),c.setAttribute("id","delete-button"),d.appendChild(c);const r=document.createElement("progress");r.classList.add("progress","is-radiusless"),r.setAttribute("value",this.books[s].lastReadIndex||0),r.setAttribute("max",this.books[s].totalIndex||1),d.appendChild(r),c.onclick=async()=>{await e.removeBook(this.books[s].id),this.books.splice(s,1),await this.render()},t.appendChild(o)}this.elem.appendChild(t)}showModal(e){this.modalElem.innerHTML="",this.modalElem.classList.add("modal","is-active","is-clipped");const t=document.createElement("div");t.classList.add("modal-background"),this.modalElem.appendChild(t),t.onclick=this.hideModal.bind(this);const s=document.createElement("div");s.classList.add("modal-content"),this.modalElem.appendChild(s);const o=document.createElement("div");o.classList.add("content","box"),s.appendChild(o);const d=document.createElement("p");o.appendChild(d),d.innerHTML=`<p>${e}</p>`;const n=document.createElement("button");n.classList.add("modal-close","is-large"),this.modalElem.appendChild(n),n.onclick=this.hideModal.bind(this)}hideModal(){this.modalElem.innerHTML="",this.modalElem.setAttribute("class","")}async syncWithServer(){this.showModal("Starting sync");const t=await e.syncWithServer();t.downloaded.length+t.uploaded.length>0?(this.showModal(`Succesfully synced: <br> down: ${t.downloaded.length}`),await this.render(),console.log("succesfully synced...","down: ",t.downloaded.length)):this.showModal("Succesfully synced")}}let o;document.addEventListener("DOMContentLoaded",(()=>{o=new s(document.getElementById("books-container"),document.getElementById("modal"))})),document.getElementById("file-input").addEventListener("change",(async function(e){e.target.files[0]&&(console.log("EPUB file: "+e.target.files[0].name),o.addBookFromFile(e.target.files[0]))})),document.getElementById("sync").addEventListener("click",(async function(e){await o.syncWithServer()}));
